# 택시 시스템 시나리오

<aside>
💡 아래의 요구사항을 만족하는 테스트 시나리오를 작성해주세요.

</aside>

### **[사용자 관점]**

1. 사용자는 출발지 / 도착지 정보를 이용해 택시를 호출할 수 있다.
    
    a. 사용자는 검색어를 통해 위치정보를 받을 수 있어야 한다. ( 출발지 / 도착지 정보 )
    
    > 카카오 Local API ( external )
    > 
    > 
    > https://developers.kakao.com/docs/latest/ko/local/dev-guide#address-coord
    > 
    
    b. 사용자는 출 / 도 정보를 이용해 실제 길찾기 이동 경로를 조회하여 택시 경로 및 가능한 택시 종류와 요금정보를 확인한다.
    
    > 카카오 모빌리티 길찾기 API ( external )
    > 
    > 
    > https://developers.kakaomobility.com/docs/navi-api/directions/
    > 
    > — 길찾기 API 에서 예상 기본 택시 요금 정보를 받아올 수 있습니다.
    > 
    > 택시 종류 (e.g.)
    > 
    > 1. 일반 : 요금 + 0원
    > 2. 고급 : 요금 + 5,000원
    > 3. 모범 : 요금 +10,000원
    
    c. 택시 종류를 선택해 택시를 호출하고 성공할 시에, 해당 택시의 정보를 받는다.
    
    - 본 시나리오에서는 운행중이지 않은 기사 가입자 중 랜덤하게 한명을 배정하는 것으로 한다.
    
    > 택시 정보에는 다음과 같은 정보가 반드시 포함되어야 합니다.
    - 기사 정보, 차량 정보
    > 
    
    d. 현재 매칭 가능한 택시가 존재하지 않을 경우, 택시 호출을 실패할 수 있습니다.
    
    - 모든 기사가 운행중인 경우, 택시 매칭을 할 수 없어 호출을 실패할 수 있다.
    - 요청 즉시 실패하기보다 적당한 Timeout 적용을 통해 원활한 매칭을 지원해 줄 수 있습니다.
2. 사용자는 특정 위치정보를 즐겨찾기로 등록할 수 있다.
3. 사용자는 택시 이용을 위해 사전에 계좌 / 카드 정보를 등록한다.
4. 택시 이용이 완료되면, 사용자의 기등록된 빌링 정보를 통해 결제를 진행한다.
    
    > 기사님이 해당 건에 대해 "운행 완료" 요청을 할 시에, 진행된다.
    > 
5. 사용자는 본인의 택시 이용 기록을 확인할 수 있다.
    
    > 택시 이용 기록에는 아래와 같은 정보가 포함된다.
    > 
    > - 호출 일시, 운행 시간
    > - 출/도 정보
    > - 탑승한 택시 정보

### **[기사님 관점]**

1. 기사님은 본인의 택시 정보를 등록한다.
2. 기사님은 현재 택시의 운행 상태 변경을 요청하고, 조회할 수 있다.
    
    > 기사님의 운행 상태는 아래와 같다.
    > 
    > - 대기중 ( 미운행 상태 )
    > - 배정 ( 운행 대기 상태 )
    > - 운행 시작 ( 운행중 상태 )
    > - 운행 완료 ( 진행중이던 운행을 완료하고, 대기중으로 자동 변경된다 )
3. 기사님은 운행 예정 정보를 조회할 수 있다. 탑승객 정보는 마스킹한다.
    - 본 시나리오에서는 운행은 자동배정되는 것으로 전제한다.
    
    > 출/도 정보예상 요금 정보
    > 
4. 기사님은 본인의 운행 기록을 통해 당일 운임료 수익 예정 정보를 확인할 수 있다.
    
    > 각 일의 운임료 수익은 00:00 - 24:00 내에 결제가 완료된 건에 대한 취합 정보이다.
    > 

<aside>
💡 이 시나리오를 선택하면, 개발 상황 및 장애대응 훈련에서 아래와 같은 상황을 맞닥뜨릴 수 있습니다.

</aside>

- 외부 API 호출에 의존적인 서비스를 구성해야 하므로 의존성에 대한 분리를 고려해 봐야함.
- 사용자들이 동시에 택시를 호출할 경우, 중복된 택시 배정이 일어날 수 있음.
    - Transaction Control, DB Isolation 등이 필요
- 기사님들이 동시에 운행완료를 호출할 경우, 결제 서비스에서 동시성 문제가 발생할 수 있음.
    - 예) 대기열시스템, Circuit breaker, Fallback 고려






----------------------------------------------------------------------------
# 유스케이스 구성요소 사용 예제

> Title (제목): UseCase의 주요 행동을 간략하게 나타내는 이름.
> 
> Actor (액터): UseCase와 상호작용하는 주체나 참여자.
> 
> Precondition (전제 조건): UseCase가 시작되기 전에 충족되어야 하는 조건.
> 
> Main Flow (주요 흐름): UseCase의 주요 행동 순서나 과정.
> 
> Alternative Flow (대안 흐름): 예외적인 상황이나 조건에서 발생할 수 있는 대체적인 행동 순서.
> 
> Postcondition (후제 조건): UseCase가 완료된 후의 상태나 결과.
> 
> Exceptions (예외): 처리가 필요한 예외적인 상황이나 에러.
> 
> Frequency of Use (사용 빈도): UseCase가 얼마나 자주 발생하는지.


```
UseCase 1: 운행 예정 정보 및 마스킹된 탑승객 정보 조회

Title: 
    - 운행 예정 정보 조회

Actor: 
    - 기사

Precondition:
    - 기사는 시스템에 로그인한 상태이다.
    - 기사 아이디는 시스템에 등록되어 있다.

Main Flow:
    - 기사는 앱에서 운행 예정 정보를 조회한다.
    - 시스템은 기사의 아이디를 기반으로 운행 예정 정보를 가져온다.
    - 시스템은 기사에게 예상 출발/도착 정보 및 요금을 표시한다.
    
Alternative Flow:
    - 유효하지 않은 기사 ID가 입력될 경우, 시스템은 예외 메시지를 반환한다.
    - 예상 출발/도착 정보가 잘못된 경우 (예: 현재 시간보다 느린 경우, 잘못된 날짜 포맷), 시스템은 예외 메시지를 반환한다.

Postcondition:
    - 기사는 앱에서 예상 출발/도착 정보 및 요금을 확인할 수 있다.

Exceptions:
    - 예상 출발/도착 정보가 ISO 8601 형식이 아닌 경우.
    - 예상 출발/도착 정보의 시간이 잘못된 경우 (예: 13월).
    - Frequency of Use: 기사마다 하루에 여러 번 사용될 수 있다.

```



----------------------------------------------------------------------------

# 다른 팀 예제

### **[기사님 관점]**

- Use Case: 기사님은 본인의 택시 정보를 등록한다.
    - 목적: 택시 정보를 등록한다.
    - 사전 조건:
        - 택시 기사 사용자가 로그인 한 상태여야 한다
    - Input values
        
        
        | 이름 | 타입 | 설명 | 필수 |
        | --- | --- | --- | --- |
        | driver_id | Long | 운전자 ID | O |
        | taxi_type | ENUM | 택시 종류 | O |
        | taxi_status | ENUM | 택시 현재 상태: 운행중, 대기 등 | O |
        | taxi_number | String | 택시 번호 | O |
        | taxi_model | String | 택시 모델 | O |
        | taxi_year | String | 택시 제조 연도 | O |
        | taxi_oil_type | String | 택시 연료 종류 | O |
        | taxi_color | ENUM | 택시 색상 | O |
        | taxi_isInsurance | Boolean | 차량 보험 가입 여부 | O |
        | taxi_vin | String | 차대 번호 | O |
        | taxi_accident_hist | AccidentHistory | 차량 사고 이력 | O |

    - Output values
        
        
        | 이름 | 타입 | 설명 | 필수 |
        | --- | --- | --- | --- |
        | taxi_id | Long | 택시 ID | O |
      
    - 기본 흐름:
        - 택시 기사로 등록된 아이디를 사용해 택시 정보를 등록한다.
        - 택시 정보로 등록되면 택시 ID가 발급 된다.
    - 대체 흐름:
        - 이미 등록된 차량 번호는 등록되지 않는다
        - 차량 정보의 차량 번호 등 필수값이 누락될 경우 등록되지 않는다
        - 운전 경력, 사고 이력, 나이 등을 바탕으로 기준에 충족하지 않을시 등록되지 않는다.
        - 한명의 택시 기사는 최대 x대의 차량을 등록 할 수 있다.
    
- Use Case: 기사님은 현재 택시의 운행 상태 변경을 요청하고, 조회할 수 있다.
    - 목적: 택시 기사님이 택시의 상태 변경 및 조회
    - 사전 조건:
        - 택시 기사 사용자가 로그인 한 상태여야 한다
        - 택시 기사 사용자가 운행 가능한 차량을 등록 해야 한다.
    - Input values
        
        
        | 이름 | 타입 | 설명 | 필수 |
        | --- | --- | --- | --- |
        | taxi_id | Long | 택시 ID | O |
        | taxi_status | ENUM | 택시 현재 상태 | O |
      
    - Output values
        - 대기중
            
            
            | 이름 | 타입 | 설명 | 필수 |
            | --- | --- | --- | --- |
            | taxi_id | Long | 택시 ID | O |
            | taxi_status | ENUM | 택시 현재 상태 | O |
          
        - 배정
            
            
            | 이름 | 타입 | 설명 | 필수 |
            | --- | --- | --- | --- |
            | taxi_id | Long | 택시 ID | O |
            | taxi_status | ENUM | 택시 현재 상태 | O |
            | user_id | Long | 사용자 ID | O |
            | location_name | String | 위치 이름 | O |
            | start_location | Road?Address | 출발지 위치 | X |
            | end_location | Road?Address | 도착지 위치 | O |
          
        - 운행시작
            
            
            | 이름 | 타입 | 설명 | 필수 |
            | --- | --- | --- | --- |
            | taxi_id | Long | 택시 ID | O |
            | taxi_status | ENUM | 택시 현재 상태 | O |
            | user_id | Long | 사용자 ID | O |
            | start_time | TimeStamp | 출발 시간 | O |
          
        - 운행 완료
            
            
            | 이름 | 타입 | 설명 | 필수 |
            | --- | --- | --- | --- |
            | taxi_id | Long | 택시 ID | O |
            | taxi_status | ENUM | 택시 현재 상태 | O |
            | user_id | Long | 사용자 ID | O |
            | end_time | TimeStamp | 도착 시간 | O |
          
    - 기본 흐름:
        - 기사님이 현재 택시의 운행 상태 변경을 요청한다
        - 기사님은 현재 상태를 언제든 조회 할 수 있다
        - 오프라인 손님을 받을 경우 대기중에서 배정 없이 바로 운행 시작으로 넘어간다
    - 대체 흐름:
        - 각 상태에서 이벤트 발생 조건을 잊고 실행하지 않을시에 대한 대비가 필요하다
            - 운행 완료 후 [운행 완료] 요청을 기사가 깜빡하였다
            - 손님의 결제 요금이 올라가고, 결제 수단이 작동하지 않을 수 있다
        - 상태 변경 중 트랜잭션 문제가 발생할 수 있다
        - 운행 상태중 대기중이 아닌 휴무, 퇴근을 지정하여 콜을 받지 못하게 한다









